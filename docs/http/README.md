# HTTP

  HTTP协议经历以下版本：

  1. HTTP/0.9
  2. HTTP/1.0
  3. HTTP/1.1
  4. HTTP/2
  5. HTTP/3

## HTTP 发展

### HTTP/0.9

  20世纪90年代初提出，没有形成规范，功能有限，动作从服务器上获取 HTML 文档，并且在响应请求之后立即关闭连接。

### HTTP/1.0

  1996年正式发布，但是并未形成标准，不具有约束力。对比HTTP/0.9有以下更新：

  1. 增加了 HEAD、POST 等新方法；
  2. 增加了响应状态码，标记可能的错误原因；
  3. 引入了协议版本号概念；
  4. 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；
  5. 传输的数据不再仅限于文本。

### HTTP/1.1

  1996年，HTTP/1.1发布RFC文档，正式确立了HTTP协议的标准。同时HTTP/1.1是目前使用最为广泛的HTTP协议版本，比起 0.9/1.0 少了“学术气”，更加“接地气”，同时表述也更加严谨。HTTP/1.1 主要的变更点有：

  1. 增加了 PUT、DELETE 等新的方法；
  2. 增加了缓存管理和控制；
  3. 明确了连接管理，允许持久连接；
  4. 允许响应数据分块（chunked），利于传输大文件；
  5. 强制要求 Host 头，让互联网主机托管成为可能。

### HTTP/2

  2015年谷歌制定发布，HTTP/2 的制定充分考虑了现今互联网的现状：宽带、移动、不安全，在高度兼容HTTP/1.1 的同时在性能改善方面做了很大努力，主要的特点有：

  1. 二进制协议，不再是纯文本；
  2. 可发起多个请求，废弃了 1.1 里的管道；
  3. 使用专用算法压缩头部，减少数据传输量；
  4. 允许服务器主动向客户端推送数据；
  5. 增强了安全性，“事实上”要求加密通信。

### HTTP/3

  2018 年，互联网标准化组织 IETF 提议将“HTTP over QUIC”更名为“HTTP/3”并获得批准，HTTP/3 正式进入了标准化制订阶段，也许两三年后就会正式发布，到时候我们很可能会跳过 HTTP/2 直接进入 HTTP/3。

## HTTP概述

  HTTP就是超文本传输协议，也就是HyperText Transfer Protocol.

### 概念拆分

  HTTP概念拆分理解为三部分：**“超文本”，“传输”和“协议”**。

  ![HTTP概念拆分理解](../.vuepress/public/http/http-1.jpg 'HTTP概念拆分理解')

### 协议

  **HTTP 是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。**

### 传输

  **HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范。**

### 超文本

  它是文字、图片、音频和视频等的混合体，最关键的是含有“超链接”，能够从一个“超文本”跳跃到另一个“超文本”，形成复杂的非线性、网状的结构关系。

### 小结

  1. HTTP 是一个用在计算机世界里的协议，它确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式
  2. HTTP 专门用来在两点之间传输数据，不能用于广播、寻址或路由。
  3. HTTP 传输的是文字、图片、音频、视频等超文本数据。
  4. HTTP 是构建互联网的重要基础技术，它没有实体，依赖许多其他的技术来实现，但同时许多技术也都依赖于它。

## TCP/IP

### TCP/IP 分成模型

![TCP/IP 分成模型](/http/http-TCPIP.jpg)

  1. 链路层（link layer），负责在以太网、WiFi 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址来标记网络上的设备，所以有时候也叫 MAC层。
  2. “网际层”或者“网络互连层”（internet layer），IP 协议就处在这一层。因为IP 协议定义了“IP 地址”的概念，所以就可以在“链接层”的基础上，用 IP 地址取代MAC 地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把 IP 地址再“翻译”成 MAC 地址就可以了。
  3. “传输层”（transport layer），这个层次协议的职责是保证数据在 IP 地址标记的两点之间“可靠”地传输。（TCP和UDP传输）
  4. “应用层”（application layer），各种面向具体应用的协议，例如 Telnet、SSH、FTP、SMTP、HTTP 等等.

  MAC 层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称为数据包。

### TCP/IP 协议栈的工作方式

![TCP/IP 分成模型](/http/http-TCPIP-work.jpg)

  以HTTP协议传输为例：

  1. 当HTTP协议进行资源的传输时，例如HTML文件，HTTP协议会为它加一个HTTP专用数据（应用层）。
  2. 资源向下层传递进过传输层 TCP 为资源加上 TCP头。
  3. 资源进过IP层和MAC层加上IP头，MAC头。
  4. 资源传输到时，依次解开头部信息，得到请求的资源。

### 小结

  1. HTTP 利用 TCP/IP 协议栈逐层打包再拆包，实现了数据传输，但下面的细节并不可见。
  2. 一般情况下，TCP/IP协议的底层又操作系统负责，代码能够影响的是第七层应用层（OSI七层网络模型）

## HTTP 基础知识

### 输入网址回车后发生了什么

  ![输入网址回车](/http/http-2.jpg)
  HTTP 请求过程（未考虑域名解析，浏览器加载）：

  1. 浏览器从地址栏的输入中获得服务器的 IP 地址和端口号；
  2. 浏览器用 TCP 的三次握手与服务器建立连接；
  3. 浏览器向服务器发送拼好的报文；
  4. 服务器收到报文后处理请求，同样拼好报文再发给浏览器；
  5. 浏览器解析报文，渲染输出页面。

  当使用域名访问WEB服务器时，会增加域名查找的IP地址的过程，查找是会在先在多级缓存中查找IP地址（浏览器缓存，系统缓存 host 文件，甚至路由器缓存），缓存中没有时则想域名服务器查找，有根域名服务器 -> 顶级域名服务器 -> 权威域名服务器 （二级域名服务器 -> 三级域名服务器）

  ![输入网址回车](/http/http-dns.jpg)

### CDN 原理

  CDN存储变化不大的资源，一般资源文件存储在CDN上。（动态的后端服务是无法CDN的）

  ![输入网址回车](/http/http-cdn.jpg)